<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--
<meta http-equiv="refresh" content="0; url=http://www.flcbranson.org/liveapp">
-->
<title>FLC Live</title>
<style>
body { margin:0; padding:0; }
/* height:auto and height:100% don't change height for iOS and it puts the controls below the screen bottom for computers and Android */
video { position:absolute; top:0; left:0; right:0; width:100%; height:100%; }
</style>
<script>
function fetchJSONFile(path, callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = function() {
		if (httpRequest.readyState === 4) {
			if (httpRequest.status === 200) {
				var data = JSON.parse(httpRequest.responseText);
				if (callback) callback(data);
			}
		}
	};
	httpRequest.open('GET', path);
	httpRequest.send(); 
}
// this requires the file and executes a callback with the parsed result once it is available
fetchJSONFile('http://www.flcbranson.org/api/livebroadcast', function(data){
	// do something with your data
	// alert(JSON.stringify(data));
	// alert(data.datetime + ', ' + data.status);
	if (data.status == 'off') {
		// Wait for Cordova to load
		document.addEventListener("deviceready", onDeviceReady, false);
		// Cordova is ready
		function onDeviceReady() {
			// external url
			var ref = window.open(encodeURI('http://www.flcbranson.org'), '_system', 'location=yes');
		}
	} else if (data.status == 'flcb') {
		document.write('<video src="http://mlmidev.webcastcenter.com/flcb_1/idev.isml/manifest(format=m3u8-aapl).m3u8" poster="http://www.flcbranson.org/images/Posters/Flcb.jpg" autoplay controls x-webkit-airplay="allow" loop>Please visit the <a href="http://www.flcbranson.org">Faith Life Church website</a> with a compatible device or computer to watch our live service.</video>');
	} else if (data.status == 'flcs') {
		document.write('<video src="http://mlmidev.webcastcenter.com/flcs_1/idev.isml/manifest(format=m3u8-aapl).m3u8" poster="http://www.flcbranson.org/images/Posters/Flcb.jpg" autoplay controls x-webkit-airplay="allow" loop>Please visit the <a href="http://www.flcbranson.org">Faith Life Church website</a> with a compatible device or computer to watch our live service.</video>');
	}
});
</script>
</head>
<body>
<script src="phonegap.js"></script>
<script>
app.initialize();
</script>
</body>
</html>