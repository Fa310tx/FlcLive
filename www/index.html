<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>FLC Live</title>
<script>
// get some JSON data
function fetchJSONFile(path, callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = function() {
		if (httpRequest.readyState === 4) {
			if (httpRequest.status === 200) {
				var data = JSON.parse(httpRequest.responseText);
				if (callback) callback(data);
			}
		}
	};
	httpRequest.open('GET', path);
	httpRequest.send(); 
}

// tell the function where the JSON data is
fetchJSONFile('http://www.flcbranson.org/api/livebroadcast', function(data){
	// do something with your data
	// alert(JSON.stringify(data));
	// alert(data.datetime + ', ' + data.status);
	if (data.status == 'flcb' || data.status == 'flcs') {
		window.location = "http://www.flcbranson.org/liveapp";
	}/* else if (data.status == 'off') {

	} else {
		document.write('<p>It seems that an error has occurred with our live broadcast <abbr title="Application Programming Interface">API</abbr>.  Please contact support through our <a href="flcsupport@moorelife.org">support e-mail address</a> or <a href="tel:+1-417-334-9233">phone number</a>.</p>');
	}*/
});

// tell the function where the JSON data is
fetchJSONFile('http://www.flcbranson.org/api/rebroadcast', function(data){
	// do something with your data
	// alert(JSON.stringify(data));
	// alert(data.sunday + ', ' + data.friday);
	var sunday = data.sunday;
	var friday = data.friday;
});
</script>
</head>
<body>
<h1><abbr title="Faith Life Church">FLC</abbr> Live Broadcast Mobile <abbr title="Application">App</abbr></h1>
<h2>Full Service Rebroadcasts</h2>
<p>Our regularly scheduled on-line broadcasts are available Sunday at 9:00 AM, Sunday at 11:00 AM, and Friday at 6:30 PM Central Time. Please join us.</p>
<p>However, Faith Life Church services are available in their entirety for a short time. Click below to watch previous services.</p>
<ul>
	<li><a href="javascript:sundayRebroadcast()">Sunday Rebroadcast</a></li>
	<li><a href="javascript:fridayRebroadcast()">Friday Rebroadcast</a></li>
</ul>
<h2>External Links (<small>opens in system browser</small>)</h2>
<ul>
	<li><a href="javascript:redirectToSystemBrowser('http://www.flcbranson.org/');">Official <abbr title="Faith Life Church">FLC</abbr> Website</a></li>
	<li><a href="javascript:redirectToSystemBrowser('https://faithlifechurchbranson.thankyou4caring.org/');">Sow to <abbr title="Faith Life Church">FLC</abbr></a></li>
</ul>
<!-- page javascript that isn't required before the page loads -->
<script>
function sundayRebroadcast() {
	window.location = "http://www.flcbranson.org/liveapp/?rebroadcastsite=" + sunday + "&amp;rebroadcastday=sun";
}

function fridayRebroadcast() {
	window.location = "http://www.flcbranson.org/liveapp/?rebroadcastsite=" + friday + "&amp;rebroadcastday=fri";
}

// window.open wasn't opening a link in the system browser on iOS, so we have to use this function
function redirectToSystemBrowser(url) {
	// Wait for Cordova to load
	document.addEventListener("deviceready", onDeviceReady, false);
	// Cordova is ready
	function onDeviceReady() {
		// open URL in default web browser
		var ref = window.open(encodeURI(url), '_system', 'location=yes');
	}
}
</script>
<!-- Google Analytics -->
<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-39575525-1']);
_gaq.push(['_trackPageview']);
(function() {
	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<!-- required for the redirectToSystemBrowser() function -->
<script src="phonegap.js"></script>
</body>
</html>